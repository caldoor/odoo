<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="assets_frontend" inherit_id="web.assets_frontend">
        <xpath expr="script[last()]" position="after">
            <script type="text/javascript" src="/caldoor_authorize/static/src/js/payment.js"></script>
        </xpath>
    </template>

    <template inherit_id="payment.payment_tokens_list" id="payment_tokens_list">
        <xpath expr="//div[hasclass('card')]" position="inside">
            <t t-set="authorize" t-value="acquirers.filtered(lambda a: a.provider == 'authorize')"/>
            <t t-if="not authorize">
                <t t-set="authorize" t-value="pms.filtered(lambda p: p.provider == 'authorize')"/>
            </t>
            <t t-if="authorize and sale_order and not sale_order.has_convenience_fee_applied()">
                
                <input type="hidden" t-att-value="fee" name="convenience_fee" id="convenience_fee"/>
                <input type="hidden" t-att-value="sale_order.id" name="sale_order_id" id="sale_order_id"/>
                <div class="card-body convenience_fee" style="display: none;">
                    <div class="alert alert-info">
                        <t t-set="amount" t-value="sale_order.amount_total"/>
                        <t t-set="c100_fee" t-options="{'widget': 'float', 'precision': 2}" t-value="((authorize.convenience_fee_percent * amount)/100)"/>
                        <t t-set="c50_fee" t-options="{'widget': 'float', 'precision': 2}" t-value="((authorize.convenience_fee_percent * (amount / 2)) /100)"/>
                        <t t-if="sale_order.payment_term_id.is_c50_term">
                            <div style="background-color: whitesmoke;">
                                <label class="ml8"> <input type="checkbox" class="payment_choice" value="c50"/> <span class="badge">50% Payment</span></label>
                                <label class="ml8"> <input type="checkbox" checked="checked" class="payment_choice" value="c100"/> <span class="badge">100% Payment</span></label>
                            </div>
                        </t>
                        <p><small>Convenience fee details for authorize payment</small></p>
                        <table class="table table-bordered" style="width: 60%;">
                            <tr>
                                <td style="padding:5px;">Order Amount</td>
                                <td class="text-right" style="padding:5px;"><span class="c100_term_field"><t t-esc="amount"/></span><span class="c50_term_field d-none"><t t-options="{'widget': 'float', 'precision': 2}" t-esc="amount / 2"/></span></td>
                            </tr>
                            <tr>
                                <td style="padding:5px;">Convenience Fee</td>
                                <td class="text-right" style="padding:5px;"><span class="c100_term_field"><t t-esc="c100_fee"/></span><span class="c50_term_field d-none"><t t-esc="c50_fee"/></span></td>
                            </tr>
                            <tr style="background-color: whitesmoke;">
                                <td style="padding:5px;">Total Payable Amount</td>
                                <td class="text-right" style="padding:5px;"><b><span class="c100_term_field"><t t-options="{'widget': 'float', 'precision': 2}" t-esc="(amount + c100_fee)"/></span><span class="c50_term_field d-none"><t t-options="{'widget': 'float', 'precision': 2}" t-esc="(amount / 2 + c50_fee)"/></span></b></td>
                            </tr>
                        </table>
                        <div style="background-color: whitesmoke;">
                            <small class="ml8"><b>Do you want to proceed ?</b></small>
                            <label class="ml8"> <input type="checkbox" class="fee_decision" name="fee_decision" value="yes"/> <span class="badge">Yes</span></label>
                            <label class="ml8"> <input type="checkbox" class="fee_decision" name="fee_decision" value="no"/> <span class="badge">No</span></label>
                        </div>
                    </div>
                </div>
            </t>
        </xpath>
        <xpath expr="//t[@t-foreach='pms']//input[@name='pm_id']" position="attributes">
            <attribute name="t-att-data-provider">pm.provider</attribute>
        </xpath>
    </template>

    <template inherit_id="sale.sale_order_portal_template" id="sale_order_portal_template">
        <xpath expr="//div[@id='payment_method']//t[@t-call='payment.payment_tokens_list']" position="inside">
            <t t-set="sale_order" t-value="sale_order"/>
        </xpath>
    </template>
</odoo>